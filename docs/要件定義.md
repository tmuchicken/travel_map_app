# 旅行経路アニメーション生成Webアプリ 要件定義書 (v10)

## 1. 概要
ユーザーが旅行の出発地から目的地までの経路を地図上にアニメーションで表示し、バス・飛行機・電車などの移動手段に応じたアイコンを使って動画風に表現できる、日本語対応のWebアプリケーションを開発する。本アプリケーションは、ユーザーがWebサイト訪問時に手軽にアニメーションを作成し、自身の環境で画面キャプチャを行うという一連の利用体験を提供することに注力する。**ローカルへのプロジェクトの永続的な保存・再利用は副次的な機能と位置づける。**

## 2. 対象ユーザー
* 旅行Vlog・旅行記の作成者
* 観光関連のSNS投稿者
* 日本語を主とする一般ユーザー

## 3. 機能要件

### 3.1 地図表示
* OpenStreetMap を利用したインタラクティブマップの表示
* 日本語ラベル対応
* ユーザーによる地図スタイルの選択機能: 複数の地図タイルレイヤー（例: 標準、シンプル表示、ダークモード対応など）からユーザーが好みのスタイルを選択できる。
* **地点マーカーのカスタマイズ表示:**
    * 各地点のマーカークリック時に表示されるポップアップに、ユーザーが設定した地名を表示する。
    * **[検討中・セッション限定]** 各地点に関連付けられた「思い出の写真」がある場合、ポップアップまたはマーカー近辺にサムネイル表示する（写真はブラウザセッション中のみ保持）。

### 3.2 経路入力と移動手段設定
* UI統合: 経路入力と各区間の移動手段選択を同一のインターフェースで行う。
* **出発地・目的地の入力:**
    * 住所または地名で検索入力。検索結果の地名は初期値として表示される。
    * **ユーザーによる地名の編集機能:** 検索結果や逆ジオコーディングで自動入力された地名を、ユーザーが自由に編集・設定できる。この設定名が地図上のマーカーポップアップ等で優先的に使用される（セッション中有効）。
* **中継地点の追加:** 複数地点を経由可能。地名入力・編集は出発地・目的地と同様。
* 移動手段の選択（アイコン付き）: バス,飛行機,電車,車,船,徒歩
* 入力補完（サジェスト）機能: あり（ジオコーディングサービスを利用）。
* 拡張 地図クリックでの地点入力（ピン刺し）: 実装済み。地図クリックで設定された地点も、地名の手動編集が可能。
* **[新規・セッション限定検討] 思い出の写真の関連付け機能 (各地点ごと、オプション):**
    * ユーザーが各地点に対して、ローカルデバイスから画像ファイルを1枚選択し、関連付けることができる。**この関連付けは現在のブラウザセッション中のみ有効とし、ローカルストレージへの保存対象外とする。**
    * 関連付けられた写真は、地図上の対応する地点マーカーと連動して表示される（表示方法は3.1参照）。
    * 写真の削除・変更機能（セッション中）。
    * *注記: 画像データはブラウザセッションが終了すると失われることをユーザーに明示する。*

### 3.3 (旧3.3 移動手段選択は 3.2 に統合)

### 3.4 アニメーション再生
* UI配置: アニメーション操作パネル（再生・停止ボタン、速度調整スライダーなど）は、地図表示エリアの近く（例: 地図の下など）に配置し、ユーザーが地図を確認しながら操作しやすいようにする。
* 出発地と目的地にピン刺しをして、ユーザー設定の地名を表示。
* 経路上をアイコンがアニメーションで移動。
* **陸上交通（バス、車、徒歩など）は、実際の道路網に基づいた経路でアニメーション表示。**
* **飛行機や船など、特定の経路に縛られない移動手段は、出発地と目的地（または中継地）間を直線または曲線でアニメーション表示。**
* アニメーション速度の調整（区間移動時間を秒数で直接入力）。
* 地図の自動スクロール・ズームイン（一部対応）。
* **[新規/強化] アニメーション品質の向上:** ユーザーが外部ツールでキャプチャすることを想定し、より滑らかで視覚的に魅力的なアニメーションの実現を目指す（詳細は別途検討）。

### 3.5 出力機能
* **本アプリケーションは、アニメーションの表示に特化する。**
* **アプリケーション内からの直接的な映像ファイル出力機能は提供しない。ユーザーが自身の環境で画面キャプチャツールを利用することを推奨する。**
* **[検討]** 静止画像としてのスクリーンショット保存機能（アプリケーション内からの簡易的なもの）は将来的に検討する可能性あり。

### 3.6 ユーザーインターフェース
* 日本語UI（全項目）

### 3.7 保存・読み込み機能
* **[優先度変更・内容変更]** プロジェクトのローカルストレージへの一時保存と再編集機能は、補助的な位置づけとして提供する。
    * **保存対象:** 地点情報（座標、ユーザーが編集したカスタム地名、移動手段）、アニメーション速度、選択した地図タイルのID。
    * **保存対象外:** 思い出の写真データ。
    * *注記: 保存機能は、ユーザーが作業を中断し、後で同じPC・ブラウザで再開する場合の利便性向上を目的とする。異なる環境へのデータ移行や永続的なデータ保証を目的とするものではないことを示唆する。*

## 4. 非機能要件

* **対応ブラウザ：** Chrome、Safari、Edge、Firefox（最新バージョン）
* **対応言語：** 日本語（初期対応）、多言語化（将来的に）
* **フロントエンド：** React (Next.js)（SPA構成）
* **地図API：** Leaflet.js + OpenStreetMap およびその他のタイルプロバイダー (CartoDBなど)
* **経路検索 (ルーティング) およびジオコーディング:**
    * OpenStreetMap利用時:
        * **ルーティングエンジン:** `Leaflet Routing Machine` (クライアントサイド) + OSRM (Open Source Routing Machine) デモサーバー
        * **ジオコーディングサービス:** Nominatim (OpenStreetMapの無料ジオコーディングサービス)
* **ホスティング:** **Vercel** を利用。
    * フロントエンドアプリケーションのデプロイに特化。
    * GitHubなどのリポジトリと連携したCI/CD機能。
    * サーバーレス関数 (Vercel Functions) のサポート。
    * 無料利用枠あり。
* **経路検索APIなどをサーバーサイドで処理する場合（必要に応じて）：** 現状クライアントサイドで完結。

## 5. 管理機能（将来的に検討）

* テンプレート保存・公開機能（ローカルまたは共有可能な形式でのエクスポート/インポートを検討）
* 利用履歴管理（ローカルでの簡易的なものを検討）

## 6. 制約事項

* 無料の経路検索APIやジオコーディングサービス、地図タイルサービスには利用規約（リクエスト頻度制限など）があるため注意が必要。
* 一部の無料地図タイルサービスは、予告なくサービス内容が変更されたり、APIキーが必要になったりする場合がある (例: Stamen)。
* **[変更]** ローカルストレージへの保存機能は補助的なものであり、ブラウザのキャッシュクリア等でデータが失われる可能性がある。また、保存できるデータ量には限りがある（特に地点情報が多い場合など）。

## ❓ 作成前に確認したことへの回答

* **ターゲット利用者:** 個人利用を前提とします。
* **動画出力の画質要件:** アプリケーション内での直接的な動画出力機能は提供しないため、この項目は該当しない。アニメーション表示の品質向上に注力する。
* **アイコンデザイン:** 既存素材を利用する予定です。
* **商用利用:** 現時点では予定していません。
* **SNS連携:** 現時点では不要です。